!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).lscache=t()}(this,function(){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var t=function(e){return Math.floor(864e13/e)},u=function(e){return e&&("QUOTA_EXCEEDED_ERR"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name||"QuotaExceededError"===e.name)},n=null,a=function(t){var e="__lscachetest__";if(null!==n)return n;try{if(!window.localStorage)return!1}catch(e){return!1}try{t.set(e,e),t.remove(e),n=!0}catch(e){console.error(e),n=!(!u(e)||!t.length)}return n},s=function(){return null!=window.JSON},r=function e(t,n,r){var c=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"buildKey",function(e){var t=c.bucketName?"".concat(c.bucketName,"/"):"";return"".concat(c.lscache.cachePrefix).concat(t).concat(e)}),i(this,"buildExpirationKey",function(e){return"".concat(e).concat(c.lscache.cacheExpirationSuffix)}),i(this,"get",function(e){if(!a(c.store))return null;if(c._flushExpiredItem(e))return null;var t=c.store.get(c.buildKey(e));if(!t||!s())return t;try{return JSON.parse(t)}catch(e){return t}}),i(this,"set",function(t,n,e){if(!a(c.store))return!1;if(!s())return!1;try{n=JSON.stringify(n)}catch(e){return!1}try{c.store.set(c.buildKey(t),n)}catch(e){if(!u(e))return console.log(e),c.lscache.warn("Could not add item with key '"+t+"'",e),!1;var r=[];c._eachKey(function(e,t){var n=c.store.get(t);n=n?parseInt(n,c.expiryRadix):c.lscache.getMaxDate(),r.push({key:e,size:(c.store.get(c.buildKey(e))||"").length,expiration:n})}),r.sort(function(e,t){return t.expiration-e.expiration});for(var i,o=(n||"").length;r.length&&0<o;)i=r.pop(),c.lscache.warn("Cache is full, removing item with key '"+t+"'"),c._flushItem(i.key),o-=i.size;try{c.store.set(c.buildKey(t),n)}catch(e){return c.lscache.warn("Could not add item with key '"+t+"', perhaps it's too big?",e),!1}}return e?c.store.set(c.buildExpirationKey(t),(c._currentTime()+e).toString(c.expiryRadix)):c.store.remove(c.buildExpirationKey(t)),!0}),i(this,"remove",function(e){a(c.store)&&c._flushItem(e)}),i(this,"flush",function(){a(c.store)&&c._eachKey(function(e){return c._flushItem(e)})}),i(this,"flushExpired",function(){a(c.store)&&c._eachKey(function(e){return _flushExpiredItem(e)})}),i(this,"_eachKey",function(e){for(var t=c.bucketName.replace(/[[\]{}()*+?.\\^$|]/g,"\\$&"),n=new RegExp("^".concat(c.lscache.cachePrefix).concat(t,"/(.*)")),r=c.store.length-1;0<=r;--r){var i=c.store.key(r);(i=(i=i&&i.match(n))&&i[1])&&i.indexOf(c.lscache.cacheExpirationSuffix)<0&&e(i,c.buildExpirationKey(i))}}),i(this,"_flushItem",function(e){c.store.remove(c.buildKey(e)),c.store.remove(c.buildExpirationKey(e))}),i(this,"_flushExpiredItem",function(e){var t=c.store.get(c.buildExpirationKey(e));if(t){var n=parseInt(t,c.expiryRadix);if(c._currentTime()>=n)return c._flushItem(e),!0}return!1}),i(this,"_currentTime",function(){return Math.floor((new Date).getTime()/c.lscache.getExpiryMilliseconds())}),this.store=t,this.lscache=n,this.bucketName=r,this.expiryRadix=10},o=!1,c=6e4,l=t(c),f={get:function(e){return window.localStorage.getItem(e)},set:function(e,t){window.localStorage.removeItem(e),window.localStorage.setItem(e,t)},remove:function(e){return window.localStorage.removeItem(e)},key:function(e){return window.localStorage.key(e)},get length(){return window.localStorage.length}},h={globalBucket:{},buckets:{},cachePrefix:"lscache-",cacheExpirationSuffix:"-expires_at",get:function(e){return h.globalBucket.get(e)},set:function(e,t,n){return h.globalBucket.set(e,t,n)},remove:function(e){return h.globalBucket.remove(e)},flush:function(){return h.globalBucket.flush()},flushExpired:function(){return h.globalBucket.flushExpired()},bucket:function(e){if(h.buckets[e])return h.buckets[e];var t=new r(f,h,e);return h.buckets[e]=t},getExpiryMilliseconds:function(){return c},getMaxDate:function(){return l},setExpiryMilliseconds:function(e){l=t(c=e)},supported:function(){return a(f)},enableWarnings:function(e){o=e},warn:function(e,t){o&&"console"in window&&"function"==typeof window.console.warn&&(window.console.warn("lscache - "+e),t&&window.console.warn("lscache - The error was: "+t.message))}};return h.globalBucket=new r(f,h,""),h});
